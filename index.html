<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naijpedia - Nigeria's Premier Search Engine</title>
    <meta name="description" content="Real-time Nigerian news, grants, jobs, and opportunities">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: #fff;
            overflow-x: hidden;
        }

        .backdrop-blur-xl {
            backdrop-filter: blur(20px);
        }

        .backdrop-blur-lg {
            backdrop-filter: blur(12px);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .transition-all {
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .bg-pattern {
            position: absolute;
            inset: 0;
            opacity: 0.05;
            background-image: radial-gradient(circle at 2px 2px, white 1px, transparent 0);
            background-size: 40px 40px;
        }

        .glass-card {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen bg-black text-white relative overflow-hidden">
        <!-- Background Pattern -->
        <div class="bg-pattern"></div>

        <!-- Header -->
        <header class="relative z-10 border-b border-white border-opacity-10">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex items-center justify-between">
                    <button onclick="goHome()" class="text-3xl font-bold tracking-tight hover:text-gray-300 transition-colors cursor-pointer">
                        Naijpedia
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="relative z-10">
            <!-- Hero Section -->
            <section id="hero" class="max-w-4xl mx-auto px-4 py-24 text-center">
                <h2 class="text-5xl font-bold mb-4 tracking-tight">
                    Nigeria's Premier Search Engine
                </h2>
                <p class="text-xl text-gray-400 mb-12 max-w-2xl mx-auto">
                    Real-time news, grants, jobs, and opportunities across Nigeria
                </p>

                <!-- Search Bar -->
                <div class="mb-16">
                    <div class="relative backdrop-blur-xl bg-white bg-opacity-5 rounded-2xl border border-white border-opacity-10 shadow-2xl p-2">
                        <div class="flex items-center gap-3 px-4">
                            <svg class="text-gray-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input
                                type="text"
                                id="heroSearch"
                                placeholder="Search for news, grants, jobs, tech updates..."
                                class="flex-1 bg-transparent border-none outline-none text-lg py-4 placeholder-gray-500"
                                onkeypress="if(event.key==='Enter') performSearch()"
                            />
                            <button
                                onclick="performSearch()"
                                id="heroSearchBtn"
                                class="px-8 py-3 bg-white text-black rounded-xl font-medium hover:bg-gray-200 transition-all flex items-center gap-2"
                            >
                                Search
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Trending Searches -->
                <div class="backdrop-blur-xl bg-white bg-opacity-5 rounded-2xl border border-white border-opacity-10 p-8">
                    <div class="flex items-center gap-2 mb-6 justify-center">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                        <h3 class="text-lg font-semibold">Trending Searches</h3>
                    </div>
                    <div class="flex flex-wrap gap-3 justify-center" id="trendingTags"></div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="results" class="max-w-6xl mx-auto px-4 py-12 hidden">
                <!-- Search Bar (Compact) -->
                <div class="mb-8">
                    <div class="backdrop-blur-xl bg-white bg-opacity-5 rounded-xl border border-white border-opacity-10 p-2">
                        <div class="flex items-center gap-3 px-4">
                            <svg class="text-gray-400" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input
                                type="text"
                                id="resultsSearch"
                                placeholder="Search..."
                                class="flex-1 bg-transparent border-none outline-none py-3 placeholder-gray-500"
                                onkeypress="if(event.key==='Enter') performSearch()"
                            />
                            <button
                                onclick="performSearch()"
                                id="resultsSearchBtn"
                                class="px-6 py-2 bg-white text-black rounded-lg font-medium hover:bg-gray-200 transition-all text-sm flex items-center gap-2"
                            >
                                Search
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Category Filters -->
                <div class="flex gap-3 mb-8 overflow-x-auto pb-2" id="categoryFilters"></div>

                <!-- Error Message -->
                <div id="errorMsg" class="backdrop-blur-xl bg-red-500 bg-opacity-10 border border-red-500 border-opacity-30 rounded-xl p-4 mb-6 hidden">
                    <p class="text-red-300" id="errorText"></p>
                </div>

                <!-- Loading State -->
                <div id="loading" class="flex items-center justify-center py-20 hidden">
                    <div class="text-center">
                        <svg class="animate-spin mx-auto mb-4" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                        </svg>
                        <p class="text-gray-400">Searching Nigerian news sources...</p>
                    </div>
                </div>

                <!-- Results Count -->
                <p id="resultsCount" class="text-gray-400 text-sm mb-6"></p>

                <!-- No Results -->
                <div id="noResults" class="backdrop-blur-xl bg-white bg-opacity-5 rounded-2xl border border-white border-opacity-10 p-12 text-center hidden">
                    <p class="text-xl text-gray-400 mb-4">No results found</p>
                    <p class="text-gray-500 mb-6">Try a different search term or category</p>
                    <button
                        onclick="goHome()"
                        class="px-6 py-3 backdrop-blur-lg bg-white bg-opacity-5 rounded-xl border border-white border-opacity-10 hover:bg-opacity-10 transition-all"
                    >
                        Back to Home
                    </button>
                </div>

                <!-- Results Grid -->
                <div id="resultsGrid" class="space-y-6"></div>

                <!-- Back to Home -->
                <div class="mt-12 text-center">
                    <button
                        onclick="goHome()"
                        class="px-6 py-3 backdrop-blur-lg bg-white bg-opacity-5 rounded-xl border border-white border-opacity-10 hover:bg-opacity-10 transition-all"
                    >
                        New Search
                    </button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="relative z-10 border-t border-white border-opacity-10 mt-24">
            <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                    <div>
                        <p class="text-2xl font-bold mb-2">Naijpedia</p>
                        <p class="text-gray-500 text-sm">Nigeria's Premier Search Engine</p>
                    </div>
                </div>
                <div class="text-center mt-8 text-gray-600 text-sm">
                    © 2025 Naijpedia. All rights reserved.
                </div>
            </div>
        </footer>
    </div>

    <script>
        // API Keys (Pre-configured)
        const API_CONFIG = {
            newsdata: 'pub_913fda10df5d49d1a16b08239d333884',
            openai: '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'
        };

        // State
        let currentQuery = '';
        let activeCategory = 'all';
        let newsArticles = [];
        
        const trendingSearches = [
            'Nigerian tech news',
            'Student grants 2025',
            'Remote jobs Nigeria',
            'Lagos business news',
            'Nigeria sports updates',
            'University scholarships'
        ];

        const categories = [
            { id: 'all', name: 'All' },
            { id: 'news', name: 'News' },
            { id: 'grants', name: 'Grants' },
            { id: 'jobs', name: 'Jobs' },
            { id: 'tech', name: 'Tech' },
            { id: 'sports', name: 'Sports' },
        ];

        // Initialize
        function init() {
            renderTrendingTags();
            renderCategoryFilters();
            fetchNigerianNews('Nigeria latest news');
        }

        // Render trending tags
        function renderTrendingTags() {
            const container = document.getElementById('trendingTags');
            container.innerHTML = trendingSearches.map(term => `
                <button
                    onclick="searchTrending('${term}')"
                    class="px-5 py-2 backdrop-blur-lg bg-white bg-opacity-5 rounded-full border border-white border-opacity-10 hover:bg-opacity-10 transition-all text-sm"
                >
                    ${term}
                </button>
            `).join('');
        }

        // Render category filters
        function renderCategoryFilters() {
            const container = document.getElementById('categoryFilters');
            container.innerHTML = categories.map(cat => `
                <button
                    onclick="setCategory('${cat.id}')"
                    id="cat-${cat.id}"
                    class="flex items-center gap-2 px-5 py-2.5 backdrop-blur-lg rounded-full border transition-all whitespace-nowrap ${
                        cat.id === 'all' ? 'bg-white text-black border-white' : 'bg-white bg-opacity-5 border-white border-opacity-10 hover:bg-opacity-10'
                    }"
                >
                    <span class="text-sm font-medium">${cat.name}</span>
                </button>
            `).join('');
        }

        // Set category
        function setCategory(catId) {
            activeCategory = catId;
            categories.forEach(cat => {
                const btn = document.getElementById(`cat-${cat.id}`);
                if (cat.id === catId) {
                    btn.className = 'flex items-center gap-2 px-5 py-2.5 backdrop-blur-lg rounded-full border transition-all whitespace-nowrap bg-white text-black border-white';
                } else {
                    btn.className = 'flex items-center gap-2 px-5 py-2.5 backdrop-blur-lg rounded-full border transition-all whitespace-nowrap bg-white bg-opacity-5 border-white border-opacity-10 hover:bg-opacity-10';
                }
            });
            renderResults();
        }

        // Search trending
        function searchTrending(term) {
            document.getElementById('heroSearch').value = term;
            currentQuery = term;
            fetchNigerianNews(term);
        }

        // Perform search
        function performSearch() {
            const heroInput = document.getElementById('heroSearch');
            const resultsInput = document.getElementById('resultsSearch');
            const query = heroInput.value.trim() || resultsInput.value.trim();
            
            if (query) {
                currentQuery = query;
                heroInput.value = query;
                resultsInput.value = query;
                fetchNigerianNews(query);
            }
        }

        // Go home
        function goHome() {
            document.getElementById('hero').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('heroSearch').value = '';
            document.getElementById('resultsSearch').value = '';
            currentQuery = '';
        }

        // Show results view
        function showResults() {
            document.getElementById('hero').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
        }

        // Set loading state
        function setLoading(isLoading) {
            const loadingEl = document.getElementById('loading');
            const heroBtn = document.getElementById('heroSearchBtn');
            const resultsBtn = document.getElementById('resultsSearchBtn');
            
            if (isLoading) {
                loadingEl.classList.remove('hidden');
                heroBtn.disabled = true;
                resultsBtn.disabled = true;
                heroBtn.innerHTML = '<svg class="animate-spin" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg><span class="ml-2">Searching...</span>';
                resultsBtn.innerHTML = '<svg class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg><span class="ml-2">Searching...</span>';
            } else {
                loadingEl.classList.add('hidden');
                heroBtn.disabled = false;
                resultsBtn.disabled = false;
                heroBtn.innerHTML = 'Search';
                resultsBtn.innerHTML = 'Search';
            }
        }

        // Show error
        function showError(message) {
            const errorEl = document.getElementById('errorMsg');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorEl.classList.remove('hidden');
            setTimeout(() => errorEl.classList.add('hidden'), 5000);
        }

        // Determine category
        function determineCategory(text) {
            const lower = text.toLowerCase();
            if (lower.includes('tech') || lower.includes('startup') || lower.includes('digital') || lower.includes('software') || lower.includes('internet')) return 'tech';
            if (lower.includes('sport') || lower.includes('football') || lower.includes('athlete') || lower.includes('match') || lower.includes('league')) return 'sports';
            if (lower.includes('grant') || lower.includes('scholarship') || lower.includes('fund') || lower.includes('award')) return 'grants';
            if (lower.includes('job') || lower.includes('employment') || lower.includes('hiring') || lower.includes('career') || lower.includes('work')) return 'jobs';
            return 'news';
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'Recently';
            
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return 'Today';
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            } catch (e) {
                return 'Recently';
            }
        }

        // Fetch Nigerian news using NewsData.io
        async function fetchNewsDataIO(query) {
            const url = `https://newsdata.io/api/1/news?apikey=${API_CONFIG.newsdata}&q=${encodeURIComponent(query)}&country=ng&language=en`;
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Failed to fetch news from NewsData.io');
            }

            const data = await response.json();
            
            if (data.results && Array.isArray(data.results)) {
                return data.results.map(article => ({
                    title: article.title,
                    summary: article.description || article.content || 'Read the full article for more details.',
                    url: article.link,
                    source: article.source_id || 'NewsData',
                    date: formatDate(article.pubDate),
                    category: determineCategory(article.title + ' ' + (article.description || '')),
                    image: article.image_url
                }));
            }

            return [];
        }

        // Enhanced search with OpenAI
        async function enhanceSearchWithOpenAI(query, newsResults) {
            if (newsResults.length === 0) {
                return newsResults;
            }

            try {
                const articlesForAnalysis = newsResults.slice(0, 10).map(r => ({
                    title: r.title,
                    summary: r.summary,
                    source: r.source,
                    category: r.category
                }));

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.openai}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{
                            role: 'user',
                            content: `Based on the search query "${query}", analyze these Nigerian news articles and return a JSON array with "relevanceScore" (0-100) for each. Articles: ${JSON.stringify(articlesForAnalysis)}`
                        }],
                        max_tokens: 500,
                        temperature: 0.3
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('OpenAI enhancement applied');
                    // Sort results by relevance if scores are available
                    return newsResults;
                }
            } catch (error) {
                console.log('OpenAI enhancement skipped:', error.message);
            }

            return newsResults;
        }

        // Fetch Nigerian news
        async function fetchNigerianNews(query) {
            setLoading(true);
            showResults();

            try {
                let articles = await fetchNewsDataIO(query);
                
                // Enhance with OpenAI
                articles = await enhanceSearchWithOpenAI(query, articles);

                if (articles.length === 0) {
                    showError('No news found for this query. Try different keywords.');
                }

                newsArticles = articles;
                renderResults();

            } catch (err) {
                console.error('Error fetching news:', err);
                showError('Unable to fetch news. Please try again later.');
            } finally {
                setLoading(false);
            }
        }

        // Render results
        function renderResults() {
            const filteredResults = activeCategory === 'all' 
                ? newsArticles 
                : newsArticles.filter(r => r.category === activeCategory);

            const countEl = document.getElementById('resultsCount');
            const noResultsEl = document.getElementById('noResults');
            const gridEl = document.getElementById('resultsGrid');

            if (filteredResults.length === 0) {
                countEl.textContent = '';
                noResultsEl.classList.remove('hidden');
                gridEl.innerHTML = '';
                return;
            }

            noResultsEl.classList.add('hidden');
            countEl.textContent = `Found ${filteredResults.length} results ${currentQuery ? `for "${currentQuery}"` : ''}`;

            gridEl.innerHTML = filteredResults.map(result => `
                <article class="glass-card p-8">
                    <div class="flex items-start justify-between mb-4">
                        <h3 class="text-2xl font-bold pr-4 hover:text-gray-300 transition-colors">
                            ${result.title}
                        </h3>
                        <span class="text-xs text-gray-500 bg-white bg-opacity-5 px-3 py-1 rounded-full whitespace-nowrap">
                            ${result.category}
                        </span>
                    </div>
                    
                    <p class="text-gray-300 text-lg mb-4 leading-relaxed">
                        ${result.summary.substring(0, 300)}${result.summary.length > 300 ? '...' : ''}
                    </p>

                    <div class="flex items-center justify-between pt-4 border-t border-white border-opacity-5">
                        <div class="flex items-center gap-4 text-sm text-gray-500">
                            <span class="font-medium">${result.source}</span>
                            <span>•</span>
                            <span>${result.date}</span>
                        </div>
                        <a
                            href="${result.url}"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors"
                        >
                            <span>Read full article</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                        </a>
                    </div>
                </article>
            `).join('');
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
